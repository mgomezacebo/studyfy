<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studyfy - Tu App de Estudio</title>
    <link rel="icon" type="image/png" href="../logos/icono.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'duo-green': '#58cc02',
                        'duo-orange': '#ff9600',
                        'duo-blue': '#1cb0f6',
                        'duo-purple': '#ce82ff',
                        'duo-red': '#ff4b4b',
                        'duo-yellow': '#ffc800',
                        'duo-text-dark': '#4b4b4b',
                        'duo-text-white': '#ffffff',
                        'duo-text-green': '#58cc02'
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'roboto': ['Roboto', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        
        .slide-up {
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .popup-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .popup-content {
            animation: popupSlide 0.3s ease-out;
        }
        
        @keyframes popupSlide {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
    <script src="../acceso/guard-sesion.js" defer></script>
</head>
<body class="font-roboto bg-gray-50 min-h-screen pb-20">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between w-full">
                <div class="flex items-center space-x-3">
                                    <img src="../logos/sin-fondo.png" alt="Studyfy" class="h-10 w-auto">
                <h1 class="font-poppins font-bold text-2xl text-duo-text-green">Studyfy</h1>
                </div>
                <button onclick="showSettings()" class="text-duo-text-dark hover:text-duo-text-green transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 py-6">
        <!-- Welcome Section -->
        <div class="text-center mb-8 fade-in">
            <h2 class="font-poppins font-semibold text-2xl text-duo-text-dark mb-2">
                ¬°Bienvenido a tu espacio de estudio!
            </h2>
            <p class="font-roboto text-duo-text-dark">
                Organiza, estudia y mejora tu aprendizaje con IA
            </p>
        </div>

        <!-- Main Actions Grid -->
        <div class="grid grid-cols-2 gap-4 mb-8">
            <!-- Chatbot -->
            <button onclick="openChatbotPopup()" class="bg-duo-blue text-white p-6 rounded-xl hover-lift text-center">
                <div class="text-3xl mb-2">ü§ñ</div>
                <div class="font-poppins font-semibold">Ir al Chatbot</div>
            </button>

            <!-- Import Content -->
            <button onclick="openImportPopup()" class="bg-duo-green text-white p-6 rounded-xl hover-lift text-center">
                <div class="text-3xl mb-2">üì•</div>
                <div class="font-poppins font-semibold">Importar Contenido</div>
            </button>

            <!-- Add Folder -->
            <button onclick="openAddFolderPopup()" class="bg-duo-orange text-white p-6 rounded-xl hover-lift text-center">
                <div class="text-3xl mb-2">üìÅ</div>
                <div class="font-poppins font-semibold">A√±adir Carpeta</div>
            </button>


        </div>

        <!-- Folders Section -->
        <div class="mb-8">
            <h3 class="font-poppins font-semibold text-xl text-duo-text-dark mb-4">Tus Carpetas</h3>
            <div id="folders-container">
                <!-- Folders will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg">
        <div class="max-w-4xl mx-auto px-4">
            <div class="flex justify-around py-3">
                <button onclick="showHomePage()" class="flex flex-col items-center space-y-1 text-duo-text-green">
                    <div class="text-2xl">üìÅ</div>
                    <span class="text-xs font-medium">Inicio</span>
                </button>
                <button onclick="showCalendarPage()" class="flex flex-col items-center space-y-1 text-duo-text-dark">
                    <div class="text-2xl">üìÖ</div>
                    <span class="text-xs font-medium">Calendario</span>
                </button>
                <button onclick="showStatsPage()" class="flex flex-col items-center space-y-1 text-duo-text-dark">
                    <div class="text-2xl">üìä</div>
                    <span class="text-xs font-medium">Estad√≠sticas</span>
                </button>
                <button onclick="showChatPage()" class="flex flex-col items-center space-y-1 text-duo-text-dark">
                    <div class="text-2xl">ü§ñ</div>
                    <span class="text-xs font-medium">Chatbot</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Chatbot Popup -->
    <div id="chatbot-popup" class="popup-overlay fixed inset-0 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="popup-content bg-white rounded-xl p-6 max-w-md w-full mx-4">
                <h3 class="font-poppins font-semibold text-xl text-duo-text-dark mb-4">¬øD√≥nde quieres ir?</h3>
                <div class="space-y-3">
                    <button onclick="goToChatGPT()" class="w-full bg-duo-green text-white py-3 px-4 rounded-lg font-medium hover:bg-green-600 transition-colors">
                        ChatGPT (Recomendado)
                    </button>
                    <button onclick="openAppChatbot()" class="w-full bg-duo-blue text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                        Chatbot en la App
                    </button>
                </div>
                <button onclick="closeChatbotPopup()" class="w-full mt-4 py-2 px-4 border border-gray-300 rounded-lg text-duo-text-dark hover:bg-gray-50 transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Popup -->
    <div id="settings-popup" class="popup-overlay fixed inset-0 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="popup-content bg-white rounded-xl p-6 max-w-md w-full mx-4">
                <h3 class="font-poppins font-semibold text-xl text-duo-text-dark mb-4">Ajustes</h3>
                <div class="space-y-4">
                    <button onclick="exportAllContent()" class="w-full bg-duo-green text-white py-3 px-4 rounded-lg font-medium hover:bg-green-600 transition-colors">
                        üì§ Exportar Todo el Contenido
                    </button>
                    <button onclick="importAllContent()" class="w-full bg-duo-blue text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                        üì• Importar Contenido Exportado
                    </button>
                    <button onclick="importFolder()" class="w-full bg-duo-orange text-white py-3 px-4 rounded-lg font-medium hover:bg-orange-600 transition-colors">
                        üìÅ Importar Carpeta
                    </button>
                    <button onclick="clearAllData()" class="w-full bg-duo-red text-white py-3 px-4 rounded-lg font-medium hover:bg-red-600 transition-colors">
                        üóëÔ∏è Borrar Todo el Contenido
                    </button>
                    <button onclick="window.location.href='log-out.html'" class="w-full bg-duo-red text-white py-3 px-4 rounded-lg font-medium hover:bg-red-600 transition-colors">
                        üîíCerrar sesi√≥n
                    </button>

                </div>
                <button onclick="closeSettings()" class="w-full mt-4 py-2 px-4 border border-gray-300 rounded-lg text-duo-text-dark hover:bg-gray-50 transition-colors">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Import Popup -->
    <div id="import-popup" class="popup-overlay fixed inset-0 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="popup-content bg-white rounded-xl p-6 max-w-md w-full mx-4">
                <h3 class="font-poppins font-semibold text-xl text-duo-text-dark mb-4">Importar Contenido</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-duo-text-dark mb-2">Subir archivo JSON</label>
                        <input type="file" id="file-input" accept=".json" class="w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-duo-text-dark mb-2">O pegar c√≥digo JSON</label>
                        <textarea id="json-input" placeholder="Pega aqu√≠ el c√≥digo JSON..." class="w-full p-2 border border-gray-300 rounded-lg h-24 resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-duo-text-dark mb-2">T√≠tulo del contenido</label>
                        <input type="text" id="content-title" placeholder="Ej: Apuntes de Matem√°ticas" class="w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-duo-text-dark mb-2">Carpeta</label>
                        <select id="folder-select" class="w-full p-2 border border-gray-300 rounded-lg">
                            <option value="">Seleccionar carpeta...</option>
                        </select>
                    </div>
                </div>
                <div class="flex space-x-3 mt-6">
                    <button onclick="importContent()" class="flex-1 bg-duo-green text-white py-2 px-4 rounded-lg font-medium hover:bg-green-600 transition-colors">
                        Importar
                    </button>
                    <button onclick="closeImportPopup()" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg text-duo-text-dark hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Folder Popup -->
    <div id="add-folder-popup" class="popup-overlay fixed inset-0 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="popup-content bg-white rounded-xl p-6 max-w-md w-full mx-4">
                <h3 class="font-poppins font-semibold text-xl text-duo-text-dark mb-4">Crear Nueva Carpeta</h3>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-duo-text-dark mb-2">Nombre de la carpeta</label>
                    <input type="text" id="folder-name" placeholder="Ej: Matem√°ticas" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div class="flex space-x-3">
                    <button onclick="createFolder()" class="flex-1 bg-duo-green text-white py-2 px-4 rounded-lg font-medium hover:bg-green-600 transition-colors">
                        Crear
                    </button>
                    <button onclick="closeAddFolderPopup()" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg text-duo-text-dark hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadAppData();
            updateFoldersDisplay();
        });

        // App data structure
        let appData = {
            folders: [],
            calendar: [],
            stats: {
                tests: [],
                exercises: [],
                flashcards: []
            }
        };

        // Load data from localStorage
        function loadAppData() {
            const saved = localStorage.getItem('studyfy-data');
            if (saved) {
                appData = JSON.parse(saved);
            }
        }

        // Save data to localStorage
        function saveAppData() {
            localStorage.setItem('studyfy-data', JSON.stringify(appData));
        }

        // Popup functions
        function openChatbotPopup() {
            const popup = document.getElementById('chatbot-popup');
            popup.classList.remove('hidden');
            
            // Agregar funcionalidad de cerrarse al hacer clic fuera
            popup.addEventListener('click', (e) => {
                if (e.target === popup) {
                    closeChatbotPopup();
                }
            });
        }

        function closeChatbotPopup() {
            document.getElementById('chatbot-popup').classList.add('hidden');
        }

        function openImportPopup() {
            const popup = document.getElementById('import-popup');
            popup.classList.remove('hidden');
            updateFolderSelect();
            
            // Agregar funcionalidad de cerrarse al hacer clic fuera
            popup.addEventListener('click', (e) => {
                if (e.target === popup) {
                    closeImportPopup();
                }
            });
        }

        function closeImportPopup() {
            document.getElementById('import-popup').classList.add('hidden');
            // Clear inputs
            document.getElementById('file-input').value = '';
            document.getElementById('json-input').value = '';
            document.getElementById('content-title').value = '';
        }

        function openAddFolderPopup() {
            const popup = document.getElementById('add-folder-popup');
            popup.classList.remove('hidden');
            
            // Agregar funcionalidad de cerrarse al hacer clic fuera
            popup.addEventListener('click', (e) => {
                if (e.target === popup) {
                    closeAddFolderPopup();
                }
            });
        }

        function closeAddFolderPopup() {
            document.getElementById('add-folder-popup').classList.add('hidden');
            document.getElementById('folder-name').value = '';
        }

        // Navigation functions
        function showHomePage() {
            // Already on home page
            updateNavigation('home');
        }

        function showCalendarPage() {
            window.location.href = 'calendar.html';
        }

        function showStatsPage() {
            window.location.href = 'stats.html';
        }

        function updateNavigation(activePage) {
            // Update navigation colors
            const navButtons = document.querySelectorAll('nav button');
            navButtons.forEach(btn => {
                btn.classList.remove('text-duo-text-green');
                btn.classList.add('text-duo-text-dark');
            });
            
            if (activePage === 'home') {
                navButtons[0].classList.remove('text-duo-text-dark');
                navButtons[0].classList.add('text-duo-text-green');
            }
        }

        // Folder functions
        function createFolder() {
            const folderName = document.getElementById('folder-name').value.trim();
            if (!folderName) return;

            const newFolder = {
                id: Date.now().toString(),
                name: folderName,
                contents: [],
                createdAt: new Date().toISOString()
            };

            appData.folders.push(newFolder);
            saveAppData();
            updateFoldersDisplay();
            closeAddFolderPopup();
        }

        function updateFoldersDisplay() {
            const container = document.getElementById('folders-container');
            
            if (appData.folders.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-duo-text-dark">
                        <div class="text-6xl mb-4">üìÅ</div>
                        <p class="font-poppins font-medium text-lg mb-2">No tienes carpetas a√∫n</p>
                        <p class="text-sm">Crea tu primera carpeta para empezar a organizar tu estudio</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = appData.folders.map(folder => `
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 hover-lift">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3 cursor-pointer" onclick="openFolder('${folder.id}')">
                            <div class="text-2xl">üìÅ</div>
                            <div>
                                <h4 class="font-poppins font-semibold text-duo-text-dark">${folder.name}</h4>
                                <p class="text-sm text-gray-500">${folder.contents.length} contenido${folder.contents.length !== 1 ? 's' : ''}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="text-duo-text-dark hover:text-duo-text-green" title="Renombrar" onclick="event.stopPropagation(); editFolderName('${folder.id}')">‚úèÔ∏è</button>
                            <button class="text-duo-red hover:text-red-700" title="Eliminar" onclick="event.stopPropagation(); deleteFolder('${folder.id}')">üóëÔ∏è</button>
                            <button class="text-duo-text-green hover:text-green-700" title="Abrir" onclick="event.stopPropagation(); openFolder('${folder.id}')">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateFolderSelect() {
            const select = document.getElementById('folder-select');
            select.innerHTML = '<option value="">Seleccionar carpeta...</option>';
            
            appData.folders.forEach(folder => {
                const option = document.createElement('option');
                option.value = folder.id;
                option.textContent = folder.name;
                select.appendChild(option);
            });
        }

        function openFolder(folderId) {
            window.location.href = `folder.html?id=${folderId}`;
        }

        function editFolderName(folderId) {
            const folder = appData.folders.find(f => f.id === folderId);
            if (!folder) return;

            showCustomPrompt('Nuevo nombre de la carpeta:', folder.name, (newName) => {
                if (newName && newName.trim() && newName.trim() !== folder.name) {
                    folder.name = newName.trim();
                    saveAppData();
                    updateFoldersDisplay();
                }
            });
        }

        function deleteFolder(folderId) {
            const folder = appData.folders.find(f => f.id === folderId);
            if (!folder) return;

            showCustomConfirm(`¬øEst√°s seguro de que quieres eliminar la carpeta "${folder.name}" y todo su contenido?`, () => {
                appData.folders = appData.folders.filter(f => f.id !== folderId);
                saveAppData();
                updateFoldersDisplay();
                showCustomAlert('Carpeta eliminada exitosamente');
            });
        }

        // Import functions
        function importContent() {
            const title = document.getElementById('content-title').value.trim();
            const folderId = document.getElementById('folder-select').value;
            
            if (!title || !folderId) {
                showCustomAlert('Por favor, completa todos los campos');
                return;
            }

            let content = null;
            
            // Try file input first
            const fileInput = document.getElementById('file-input');
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        content = JSON.parse(e.target.result);
                        processImportedContent(content, title, folderId);
                    } catch (error) {
                        showCustomAlert('Error al leer el archivo JSON');
                    }
                };
                reader.readAsText(file);
            } else {
                // Try text input
                const jsonInput = document.getElementById('json-input').value.trim();
                if (jsonInput) {
                    try {
                        content = JSON.parse(jsonInput);
                        processImportedContent(content, title, folderId);
                    } catch (error) {
                        showCustomAlert('Error en el formato JSON');
                    }
                } else {
                    showCustomAlert('Por favor, sube un archivo o pega c√≥digo JSON');
                }
            }
        }

        function processImportedContent(content, title, folderId) {
            const folder = appData.folders.find(f => f.id === folderId);
            if (!folder) return;

            const newContent = {
                id: Date.now().toString(),
                title: title,
                type: content.type || 'unknown',
                data: content,
                importedAt: new Date().toISOString()
            };

            folder.contents.push(newContent);
            saveAppData();
            updateFoldersDisplay();
            closeImportPopup();
            
            showCustomAlert('Contenido importado exitosamente');
        }

        // Export functions
        function exportAllContent() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'studyfy-export.json';
            document.body.appendChild(link);
            link.click();
            link.remove();
            URL.revokeObjectURL(url);
        }

        // Custom alert function
        function showCustomAlert(message) {
            const alertPopup = document.createElement('div');
            alertPopup.className = 'popup-overlay fixed inset-0 z-50 flex items-center justify-center';
            alertPopup.innerHTML = `
                <div class="popup-content bg-white rounded-xl p-6 max-w-md w-full mx-4">
                    <div class="text-center">
                        <div class="text-4xl mb-4">‚ÑπÔ∏è</div>
                        <p class="font-poppins font-medium text-duo-text-dark mb-6">${message}</p>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="bg-duo-green text-white py-2 px-6 rounded-lg font-medium hover:bg-green-600 transition-colors">
                            Aceptar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(alertPopup);
            
            // Close on background click
            alertPopup.addEventListener('click', (e) => {
                if (e.target === alertPopup) {
                    alertPopup.remove();
                }
            });
        }

        // Custom prompt function
        function showCustomPrompt(message, defaultValue, callback) {
            const promptPopup = document.createElement('div');
            promptPopup.className = 'popup-overlay fixed inset-0 z-50 flex items-center justify-center';
            promptPopup.id = 'prompt-popup-overlay';
            promptPopup.innerHTML = `
                <div class="popup-content bg-white rounded-xl p-6 max-w-md w-full mx-4">
                    <div class="text-center">
                        <div class="text-4xl mb-4">‚úèÔ∏è</div>
                        <p class="font-poppins font-medium text-duo-text-dark mb-4">${message}</p>
                        <input type="text" id="custom-prompt-input" value="${defaultValue}" class="w-full p-3 border border-gray-300 rounded-lg mb-4 font-roboto">
                        <div class="flex space-x-3">
                            <button onclick="submitCustomPrompt()" class="flex-1 bg-duo-green text-white py-2 px-4 rounded-lg font-medium hover:bg-green-600 transition-colors">
                                Aceptar
                            </button>
                            <button onclick="closeCustomPrompt()" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg text-duo-text-dark hover:bg-gray-50 transition-colors">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(promptPopup);
            
            // Store callback globally
            window.customPromptCallback = callback;
            
            // Focus input
            setTimeout(() => {
                document.getElementById('custom-prompt-input').focus();
            }, 100);
            
            // Close on background click
            promptPopup.addEventListener('click', (e) => {
                if (e.target === promptPopup) {
                    closeCustomPrompt();
                }
            });
        }

        function submitCustomPrompt() {
            const input = document.getElementById('custom-prompt-input');
            const value = input.value;
            if (window.customPromptCallback) {
                window.customPromptCallback(value);
            }
            closeCustomPrompt();
        }

        function closeCustomPrompt() {
            const popup = document.getElementById('prompt-popup-overlay');
            if (popup) {
                popup.remove();
            }
            window.customPromptCallback = null;
        }

        // External functions
        function goToChatGPT() {
            window.open('https://chatgpt.com/g/g-68a3a22fa6a08191b6e4f009fd4f71ea-studyfy', '_blank');
            closeChatbotPopup();
        }

        function openAppChatbot() {
            window.location.href = 'chat.html';
        }

        // Settings functions
        function showSettings() {
            const popup = document.getElementById('settings-popup');
            if (popup) {
                popup.classList.remove('hidden');
                
                // Agregar funcionalidad de cerrarse al hacer clic fuera
                popup.addEventListener('click', (e) => {
                    if (e.target === popup) {
                        closeSettings();
                    }
                });
            }
        }

        function closeSettings() {
            const popup = document.getElementById('settings-popup');
            if (popup) {
                popup.classList.add('hidden');
            }
        }

        function importAllContent() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (importedData.folders) {
                                appData.folders = importedData.folders;
                                saveAppData();
                                updateFoldersDisplay();
                                showCustomAlert('Contenido importado exitosamente');
                            } else {
                                showCustomAlert('Formato de archivo no v√°lido');
                            }
                        } catch (error) {
                            showCustomAlert('Error al leer el archivo JSON');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function importFolder() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (importedData.folder) {
                                if (!appData.folders) appData.folders = [];
                                appData.folders.push(importedData.folder);
                                saveAppData();
                                updateFoldersDisplay();
                                showCustomAlert('Carpeta importada exitosamente');
                            } else {
                                showCustomAlert('Formato de archivo no v√°lido');
                            }
                        } catch (error) {
                            showCustomAlert('Error al leer el archivo JSON');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function clearAllData() {
            showCustomConfirm('¬øEst√°s seguro de que quieres borrar todo el contenido? Esta acci√≥n no se puede deshacer.', () => {
                localStorage.removeItem('studyfy-data');
                appData = { folders: [], calendar: [], stats: { tests: [], exercises: [], flashcards: [] } };
                updateFoldersDisplay();
                showCustomAlert('Todo el contenido ha sido borrado');
            });
        }

        function showChatPage() {
            window.location.href = 'chat.html';
        }

        // Custom confirm function
        function showCustomConfirm(message, callback) {
            const existing = document.getElementById('confirm-popup-overlay');
            if (existing) existing.remove();
            const confirmPopup = document.createElement('div');
            confirmPopup.id = 'confirm-popup-overlay';
            confirmPopup.className = 'popup-overlay fixed inset-0 z-50 flex items-center justify-center';
            confirmPopup.innerHTML = `
                <div class="popup-content bg-white rounded-xl p-6 max-w-md w-full mx-4">
                    <div class="text-center">
                        <div class="text-4xl mb-4">‚ö†Ô∏è</div>
                        <p class="font-poppins font-medium text-duo-text-dark mb-6">${message}</p>
                        <div class="flex space-x-3">
                            <button onclick="submitCustomConfirm()" class="flex-1 bg-duo-red text-white py-2 px-4 rounded-lg font-medium hover:bg-red-600 transition-colors">
                                Confirmar
                            </button>
                            <button onclick="closeCustomConfirm()" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg text-duo-text-dark hover:bg-gray-50 transition-colors">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmPopup);
            window.customConfirmCallback = callback;
            confirmPopup.addEventListener('click', (e) => { if (e.target === confirmPopup) closeCustomConfirm(); });
        }

        function submitCustomConfirm() {
            if (window.customConfirmCallback) {
                window.customConfirmCallback();
            }
            closeCustomConfirm();
        }

        function closeCustomConfirm() {
            const popup = document.getElementById('confirm-popup-overlay');
            if (popup) popup.remove();
            window.customConfirmCallback = null;
        }

        // Initialize navigation
        updateNavigation('home');
    </script>
</body>
</html>
